[
  {
    "id": "AI-SUG-001",
    "area": "runtime/ai-sdk",
    "title": "Require callOptions when callOptionsSchema is set",
    "files": [
      "packages/runtime/src/types.ts:159",
      "packages/runtime/src/types.ts:215",
      "packages/runtime/src/agent-runtime.ts:435",
      "packages/runtime/src/subagents.ts:139"
    ],
    "summary": "`AgentCallOptions` marks `options` as optional even when `callOptionsSchema` is defined, which diverges from AI SDK behavior where options become required and type-checked.",
    "suggested_change": "Make the requirement explicit at the type level by conditioning `AgentCallOptions` (or method overloads for `prompt`/`continue`) on whether `callOptionsSchema` exists. Add a runtime guard in `AgentRuntime.runOnce` that throws a clear error if `callOptionsSchema` is set but `options` is missing, so misconfigurations fail fast. For subagents, either add an `options` field to `SubagentToolInput` or provide a mapping hook so call options can be passed through when a subagent relies on them.",
    "rationale": "AI SDK docs for call options state that the `options` object becomes required once a schema is provided. Without enforcement, `prepareCall` can run with undefined inputs and silently misconfigure models/tools. Enforcing the contract keeps usage aligned with the SDK and avoids subtle runtime errors.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-002",
    "area": "runtime/ai-sdk",
    "title": "Implement tool approval flow for sensitive tools",
    "files": [
      "packages/runtime/src/agent-runtime.ts:454",
      "packages/runtime/src/toolset.ts:55",
      "packages/runtime/src/tools/bash.ts:34",
      "packages/runtime/src/tools/write.ts:36",
      "packages/runtime/src/tools/edit.ts:40",
      "packages/runtime/src/tools/webfetch.ts:28"
    ],
    "summary": "The SDK supports tool approvals via `needsApproval` and `tool-approval-request` stream parts, but the runtime ignores these parts and none of the built-in high-risk tools enable approval.",
    "suggested_change": "Mark destructive tools (`bash`, `write`, `edit`, and possibly `webfetch`) with `needsApproval: true` by default (or make it opt-in via tool options). Handle `tool-approval-request` in the stream loop by emitting a dedicated event with `approvalId` and the tool call payload, and expose a helper to append `tool-approval-response` messages and resume the agent. Consider adding a standard system instruction when approval is denied to discourage retry loops.",
    "rationale": "AI SDK’s approval workflow is the recommended pattern for sensitive operations. Right now approvals would be silently ignored, which can result in missing tool execution or confusing stalls. Wiring the flow makes agent behavior explicit and safer.",
    "risk": "medium",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-003",
    "area": "runtime/ai-sdk",
    "title": "Expand AgentToolDefinition to match AI SDK tool API",
    "files": ["packages/runtime/src/types.ts:56", "packages/runtime/src/toolset.ts:55"],
    "summary": "The current `AgentToolDefinition` omits several supported tool properties (`inputExamples`, `onInputStart`, `onInputDelta`, `onInputAvailable`, and provider-defined tool fields like `type`/`id`/`args`).",
    "suggested_change": "Extend `AgentToolDefinitionBase` to include the missing fields and forward them in `createToolSet` when calling `tool()`. This unlocks input examples for better tool calling, streaming input hooks for richer UIs, and provider-defined tools for providers that expose them. Keep the additions optional so existing tools remain valid.",
    "rationale": "AI SDK’s tool reference documents these properties as first-class capabilities. Aligning your tool definition with the SDK keeps the runtime compatible with the full feature set and reduces friction when adding advanced tools.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-004",
    "area": "runtime/ai-sdk",
    "title": "Honor abortSignal in tool implementations",
    "files": [
      "packages/runtime/src/tools/bash.ts:43",
      "packages/runtime/src/tools/webfetch.ts:34",
      "packages/runtime/src/tools/write.ts:47",
      "packages/runtime/src/tools/edit.ts:51",
      "packages/runtime/src/tools/list.ts:59"
    ],
    "summary": "Tool execution receives `abortSignal`, but most built-in tools ignore it and continue work after cancellation.",
    "suggested_change": "Pass `execOptions.abortSignal` into tool implementations and exit early on abort. For `bash`, listen to `abortSignal` and kill the spawned process. For `webfetch`, merge the tool abort signal with the internal timeout controller (e.g., `AbortSignal.any`). For filesystem tools, check `signal.aborted` before and after I/O steps and throw an abort error if set. This keeps tool execution responsive to user cancels.",
    "rationale": "AI SDK expects tool calls to honor cancellation so the agent can stop promptly. Ignoring abort signals can waste resources and return stale results after a user has moved on.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-005",
    "area": "runtime/ai-sdk",
    "title": "Surface additional TextStreamPart metadata",
    "files": ["packages/runtime/src/agent-runtime.ts:454", "packages/runtime/src/types.ts:119"],
    "summary": "The stream loop ignores reasoning, tool-input deltas, sources/files, and finish metadata, even though these parts are emitted by AI SDK full streams.",
    "suggested_change": "Add AgentEvent variants (or optional callbacks) for reasoning deltas, tool-input streaming, source/file parts, and `start`/`finish` usage metadata. Consider collecting `finish.totalUsage` and `finishReason` into the runtime state so callers can track cost and model behavior without reprocessing raw streams.",
    "rationale": "AI SDK exposes these stream parts specifically to enable richer UIs (streamed tool args, citations, file outputs) and analytics. Capturing them preserves information that is otherwise lost during streaming.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-006",
    "area": "runtime/ai-sdk",
    "title": "Pass through advanced ToolLoopAgent settings",
    "files": [
      "packages/runtime/src/types.ts:159",
      "packages/runtime/src/agent-runtime.ts:416",
      "packages/runtime/src/subagents.ts:102"
    ],
    "summary": "Several ToolLoopAgent options supported by the AI SDK (`activeTools`, `experimental_repairToolCall`, `experimental_context`, `experimental_download`, `experimental_telemetry`) are not exposed in `AgentConfig` or passed through.",
    "suggested_change": "Extend `AgentConfig` (and subagent config) to include these fields and forward them into the ToolLoopAgent constructor. Optionally allow per-call overrides in `AgentCallOptions`. This preserves current behavior while enabling tool gating, automatic tool-call repair, custom download handling, and DevTools telemetry when desired.",
    "rationale": "These settings are part of the official ToolLoopAgent API and are recommended for best-practice workflows like phase-based tool selection (`activeTools`) and debugging (`experimental_telemetry`). Exposing them keeps your runtime aligned with the SDK surface.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-007",
    "area": "runtime/ai-sdk",
    "title": "Add input examples and strict mode to tool schemas",
    "files": [
      "packages/runtime/src/tools/bash.ts:11",
      "packages/runtime/src/tools/edit.ts:13",
      "packages/runtime/src/tools/webfetch.ts:14",
      "packages/runtime/src/toolset.ts:55"
    ],
    "summary": "Tool schemas are descriptive, but they do not leverage `inputExamples` or `strict`, which are supported by the SDK and can improve tool-call correctness.",
    "suggested_change": "For complex or high-risk tools, add a couple of representative `inputExamples` and enable `strict: true` (when supported by the provider) to ensure valid inputs. Make these configurable in tool factory options so callers can tune behavior. Ensure `inputExamples` are passed through once the tool definition type is expanded.",
    "rationale": "AI SDK docs note that input examples can improve tool-call accuracy, and strict mode ensures valid JSON for providers that support it. This reduces invalid tool calls and improves reliability for destructive tools.",
    "risk": "low",
    "effort": "small",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-008",
    "area": "runtime/ai-sdk",
    "title": "Allow subagents to accept call options",
    "files": ["packages/runtime/src/subagents.ts:67", "packages/runtime/src/subagents.ts:139"],
    "summary": "`SubagentToolInput` only supports a `prompt`, so subagents cannot use `callOptionsSchema` even if their config defines it.",
    "suggested_change": "Extend the subagent tool input schema to include an optional `options` object and pass it into `agent.stream({ options })`. Alternatively, allow a `mapCallOptions` function on `SubagentSpec` to derive options from the parent tool input or shared memory. This keeps subagents consistent with the SDK’s call-options best practice.",
    "rationale": "Call options are the SDK’s recommended mechanism for dynamic per-call configuration. Without passthrough, subagents are forced to encode options into prompts or maintain separate agents per configuration.",
    "risk": "low",
    "effort": "medium",
    "status": "proposed"
  },
  {
    "id": "AI-SUG-009",
    "area": "runtime/ai-sdk",
    "title": "Narrow callSettings to match ToolLoopAgent constructor",
    "files": [
      "packages/runtime/src/types.ts:167",
      "packages/runtime/src/agent-runtime.ts:416",
      "packages/runtime/src/subagents.ts:102"
    ],
    "summary": "`AgentConfig.callSettings` uses `CallSettings`, which includes `abortSignal`, but ToolLoopAgent settings explicitly omit `abortSignal` at construction time.",
    "suggested_change": "Change `callSettings` to `Omit<CallSettings, 'abortSignal'>` (or strip `abortSignal` before spreading) so only supported fields are forwarded to the agent. Keep `abortSignal` strictly in `AgentCallOptions` for per-call control.",
    "rationale": "This aligns with the AI SDK API shape and prevents accidental misuse of `abortSignal` at configuration time, which can lead to confusing, non-functional settings.",
    "risk": "low",
    "effort": "small",
    "status": "proposed"
  }
]
